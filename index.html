<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Po√®me en fleurs</title>
<style>
  html, body {
    margin: 0; padding: 0; overflow: hidden; height: 100%;
    background: radial-gradient(circle, #1a1a2e, #0f0f1a);
    font-family: 'Courier New', Courier, monospace;
    user-select: none;
  }

  .letter {
    position: absolute;
    font-size: 1.3rem;
    color: #fffbe6;
    opacity: 0.8;
    cursor: default;
    transition: left 1.5s ease, top 1.5s ease;
    will-change: left, top;
  }

  .flower {
    position: absolute;
    font-size: 24px;
    cursor: pointer;
    user-select: none;
    z-index: 10;
    transition: transform 0.3s ease;
  }

  .flower:hover {
    transform: scale(1.3);
  }
</style>
</head>
<body>

<script>
(() => {
  const phrase = `Que mon bonheur portes ton nom
Que tes yeux rangent mon espace
Que je sois ton terrain conquis

Ainsi deviendront-nous
cette rose unique
√† jamais sauv√©e
du long d√©ssechement

Ainsi pourrons-nous vivre
sans faiblir au coeur
des foules grima√ßantes
et soutenir la lumi√®re crue
des mauvais jours

Je t'offres les l√®vres de ma plaie
c'est la plus grande douceur que j'ai
Je t'offre l'etreinte de l'absent
c'est le plus long voyage du sang
Je t'offre la voix de mes silences
c'est la plus s√ªre des confidences
Je t'offre de t'aimer Dieu sait o√π

n'est-ce pas le seul des rendez-vous ?`;

  const letters = [];
  const floatingSpeed = 0.1;
  let phrasePositions = [];
  let isPhraseShown = false;
  const fontSize = 20;
  const lineHeight = fontSize * 1.6;

  function initLetters() {
    for (let i = 0; i < phrase.length; i++) {
      const span = document.createElement('span');
      span.className = 'letter';
      span.textContent = phrase[i];
      span.style.left = `${Math.random() * window.innerWidth}px`;
      span.style.top = `${Math.random() * window.innerHeight}px`;
      document.body.appendChild(span);

      letters.push({
        el: span,
        x: parseFloat(span.style.left),
        y: parseFloat(span.style.top),
        dx: (Math.random() - 0.5) * floatingSpeed,
        dy: (Math.random() - 0.5) * floatingSpeed,
      });
    }
  }

  function computePhrasePositions() {
    phrasePositions = [];

    const lines = phrase.split('\n');
    const totalHeight = lines.length * lineHeight;
    const startY = (window.innerHeight - totalHeight) / 2;

    const tempDiv = document.createElement('div');
    tempDiv.style.position = 'absolute';
    tempDiv.style.visibility = 'hidden';
    tempDiv.style.whiteSpace = 'nowrap';
    tempDiv.style.fontSize = '1.3rem';
    tempDiv.style.fontFamily = "'Courier New', Courier, monospace";
    document.body.appendChild(tempDiv);

    let letterIndex = 0;
    for(let lineIndex = 0; lineIndex < lines.length; lineIndex++) {
      const line = lines[lineIndex];

      tempDiv.textContent = line.replace(/ /g, '\u00A0');
      const lineWidth = tempDiv.offsetWidth;

      let startX = (window.innerWidth - lineWidth) / 2;
      const y = startY + lineIndex * lineHeight;

      for(let i = 0; i < line.length; i++) {
        const ch = line[i] === ' ' ? '\u00A0' : line[i];
        tempDiv.textContent = ch;
        const w = tempDiv.offsetWidth;

        phrasePositions[letterIndex] = { x: startX, y: y };
        startX += w;
        letterIndex++;
      }

      if(lineIndex < lines.length - 1) {
        phrasePositions[letterIndex] = { x: 0, y: 0 };
        letterIndex++;
      }
    }

    document.body.removeChild(tempDiv);
  }

  function animateFloating() {
    for (const letter of letters) {
      letter.x += letter.dx;
      letter.y += letter.dy;

      if (letter.x < 0 || letter.x > window.innerWidth - letter.el.offsetWidth) letter.dx *= -1;
      if (letter.y < 0 || letter.y > window.innerHeight - letter.el.offsetHeight) letter.dy *= -1;

      letter.el.style.left = `${letter.x}px`;
      letter.el.style.top = `${letter.y}px`;
    }
  }

  function alignPhrase() {
    letters.forEach((letter, i) => {
      if (!phrasePositions[i]) {
        letter.el.style.opacity = '0';
        return;
      } else {
        letter.el.style.opacity = '0.8';
      }

      const target = phrasePositions[i];
      letter.x = target.x;
      letter.y = target.y;
      letter.el.style.left = `${target.x}px`;
      letter.el.style.top = `${target.y}px`;

      letter.dx *= 0.1;
      letter.dy *= 0.1;
    });
  }

  function disperseLetters() {
    letters.forEach((letter) => {
      letter.el.style.opacity = '0.8';

      letter.dx = (Math.random() - 0.5) * floatingSpeed * 3;
      letter.dy = (Math.random() - 0.5) * floatingSpeed * 3;

      letter.x = Math.random() * (window.innerWidth - letter.el.offsetWidth);
      letter.y = Math.random() * (window.innerHeight - letter.el.offsetHeight);

      letter.el.style.left = `${letter.x}px`;
      letter.el.style.top = `${letter.y}px`;
    });
  }

  function toggleDisplay() {
    if (!isPhraseShown) {
      computePhrasePositions();
      alignPhrase();
    } else {
      disperseLetters();
    }
    isPhraseShown = !isPhraseShown;
  }

  function createFallingFlower() {
    const flower = document.createElement('div');
    flower.className = 'flower';
    flower.textContent = 'üå∏';
    flower.style.left = `${Math.random() * window.innerWidth}px`;
    flower.style.top = `-30px`;
    document.body.appendChild(flower);

    let y = -30;
    const fallSpeed = 1 + Math.random() * 1;

    function fall() {
      y += fallSpeed;
      flower.style.top = `${y}px`;

      if (y > window.innerHeight + 30) {
        document.body.removeChild(flower);
      } else {
        requestAnimationFrame(fall);
      }
    }

    flower.addEventListener('click', () => {
      toggleDisplay();
    });

    fall();
  }

  function loopFlowerRain() {
    setInterval(() => {
      createFallingFlower();
    }, 1500);
  }

  window.addEventListener('resize', () => {
    if (isPhraseShown) {
      computePhrasePositions();
      alignPhrase();
    }
  });

  function loop() {
    animateFloating();
    requestAnimationFrame(loop);
  }

  initLetters();
  loop();
  loopFlowerRain();
})();
</script>

</body>
</html>
